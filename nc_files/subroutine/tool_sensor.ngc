o<tool_sensor> sub

#<max_probe> = #<_ini[TOOLSENSOR]maxprobe>
#<search_vel> = #<_ini[TOOLSENSOR]search_vel>
#<probe_vel> = #<_ini[TOOLSENSOR]probe_vel>
#<sensor_height_G53> = #<_ini[TOOLSENSOR]height> (probed spindle nose in G53 machine coord.)

(print, max_probe is #<max_probe>)
(print, search vel is #<search_vel>)
(print, probe vel is #<probe_vel>)
(print, sensor height is #<sensor_height_G53>)

G21 (use metric units)
G53 G90 G0 Z10 (raise spindle to Z0)
G53 G90 G0 X#<_ini[TOOLSENSOR]x> Y#<_ini[TOOLSENSOR]y>
G49 (cancel tool offset)
G91 (switch to incremental mode)

; this section commented out for sim
G38.2 Z[-#<max_probe>] F#<search_vel> (probe down)
G1 Z4.0 (move up 4 mm)
G4 P0.5 (pause for 0.5 sec.)
G38.2 Z-6.0 F#<probe_vel> (probe down slower)

; calculate in G53 machine coords
#<probed_height_G53> = #5063 + #5223
#<tool_length> = #<probed_height_G53> - #<sensor_height_G53>  
(print, calculated tool length is #<tool_length>)
#3 = #<tool_length> (store the value in global var for further using)

G90 (absolute distance mode)
G53 G0 Z10 (move Z up to 0)
o<tool_sensor> endsub
M2
